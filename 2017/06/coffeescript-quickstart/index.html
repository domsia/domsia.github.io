<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> coffeescript 速览 · domsia</title><meta name="description" content="coffeescript 速览 - domsia"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.domsia.com/atom.xml" title="domsia"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/domsia" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">coffeescript 速览</h1><div class="post-info">Jun 29, 2017</div><div class="post-content"><p>作为一个已经放弃前端的人，我其实是不太想在碰这些东西的，但是因为sageMathCloud这个开源项目基本都是用<code>coffeescript</code>写的，没办法，还是要看，也许还有不一样的发现呢。<br>CoffeeScript 是一门编译到 JavaScript 的小巧语言，它借鉴了Ruby，python和Haskell的语法，代码可以一一对应的编译到JS，也可以使用已有的各种JS类库。它语法简洁，相对于JS有较高的安全性。</p>
<p>安装：</p>
<blockquote>
<p> $ sudo npm install -g coffee-script</p>
</blockquote>
<p>对我来说， 学习这门语言最大的好处就是，深入理解了很多JS存在的问题以及在JS代码中需要注意的各种问题。</p>
<p>例如：使用 JavaScript 循环生成函数的时候, 经常会添加一个闭包来包裹代码, 这样做目的是为了循环的变量被保存起来, 而不是所有生成的函数搜去访问最后一个循环的变量. CoffeeScript 提供了一个 do 关键字, 用来直接调用跟在后边的函数, 并且传递需要的参数.<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> list</div><div class="line">  <span class="keyword">do</span> (filename) -&gt;</div><div class="line">    fs.readFile filename, <span class="function"><span class="params">(err, contents)</span> -&gt;</span></div><div class="line">      compile filename, contents.toString()</div></pre></td></tr></table></figure></p>
<p>编译后的JS代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Generated by CoffeeScript 1.12.6</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> filename, fn, i, len;</div><div class="line"></div><div class="line">  fn = <span class="function"><span class="keyword">function</span>(<span class="params">filename</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fs.readFile(filename, <span class="function"><span class="keyword">function</span>(<span class="params">err, contents</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> compile(filename, contents.toString());</div><div class="line">    &#125;); </div><div class="line">  &#125;;  </div><div class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>, len = list.length; i &lt; len; i++) &#123;</div><div class="line">    filename = list[i];</div><div class="line">    fn(filename);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;).call(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>可以发现相比于js代码，coffeeScript简洁了不少，语法也更清晰。还有其它如类，继承等，都做了简化和改进，当然了ES6在这方面也做了很多的工作。具体的入门中文版地址： <a href="http://coffee-script.org" target="_blank" rel="external">http://coffee-script.org</a></p>
<hr>
<p>果然看看还是有好处的，比如：</p>
<ol>
<li><p>source map<br>js脚本大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。<br>常见的源码转换，主要是以下三种情况：<br>　　（1）压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。<br>　　（2）多个文件合并，减少HTTP请求数。<br>　　（3）其他语言编译成JavaScript。最常见的例子就是CoffeeScript。<br>source map就是通过转化后的代码找到对应的原始位置。对应的原理有 VLQ 编码。<br><a href="https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" rel="external">Introduction to JavaScript Source Maps</a><br><a href="http://coffee-script.org/documentation/docs/sourcemap.html" target="_blank" rel="external">coffeescript source map: SOURCEMAP.LITCOFFEE</a> </p>
</li>
<li><p>jison<br>JavaScript的解析器， Coffee就是用<a href="https://github.com/zaach/jison" target="_blank" rel="external">Jison</a> 解析的。它将一个上下文无关的语法做为输入，输出对应的JavaScript代码。<br>简单的例子：通过 <a href="https://github.com/zaach/jison/blob/master/examples/calculator.jison" target="_blank" rel="external">calculator.jison</a> 生成parsers:  </p>
<blockquote>
<p> $  jison calculator.jison   </p>
</blockquote>
<p>  执行后生成了calculator.js 文件，执行这个文件，将会将会parse一个输入文件，计算其内容  </p>
<blockquote>
<p> $ echo “2^32 / 1024” &gt; testcalc<br> $ node calculator.js testcalc</p>
</blockquote>
<p>   将会得到结果 <code>4194304</code></p>
<hr>
<p>了解和学习下来，感觉coffee在语法简洁上的改进的意义远远大于其它方面，使用者也大都是那些用了很长时间的js的开发者，能让他们更好的专注于业务而不用去折腾那种java风格的js代码。</p>
</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/docker-swarm-and-weave/" class="prev">PREV</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2017/06/coffeescript-quickstart/';
var disqus_title = 'coffeescript 速览';
var disqus_url = 'http://blog.domsia.com/2017/06/coffeescript-quickstart/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://blog.domsia.com">domsia</a>, powered by liu0218dong.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>